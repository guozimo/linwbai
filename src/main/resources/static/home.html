<!DOCTYPE html>
<HTML>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="js/lib/vue.js"></script>
    <!--<script type="text/javascript" src="js/lib/vue-resource.min.js"></script>-->
    <script type="text/javascript" src="js/lib/jquery-3.0.0.min.js"></script>
    <script type="text/javascript">
        window.onload = function () {
            var body_ = new Vue({
                el: 'body',
                data: {

                },
                ready: function () {
                    chessData = new Array(15).fill(0).map(function () {
                        return new Array(15).fill(0);
                    });
                    canvas = document.getElementById("canvas");
                    context = canvas.getContext("2d");
                    for (var i = 0; i <= 640; i += 40) {//绘制棋盘的线
                        context.beginPath();
                        context.moveTo(0, i);
                        context.lineTo(640, i);
                        context.closePath();
                        context.stroke();
                        context.beginPath();
                        context.moveTo(i, 0);
                        context.lineTo(i, 640);
                        context.closePath();
                        context.stroke();
                    }
                },
                methods: {
                }
            });


        }

//        var canvas_ = new Vue({
//            el: '#canvas',
//            data: {
//
//            },
//            ready: function () {
//
//            },
//            methods: {
//                play: function(e) {
//                    var x = parseInt((e.clientX - 20)/40);
//                    var y = parseInt((e.clientY - 20)/40);
//                    if(x > 14 || y > 14 || chessData[x][y] != 0){
//                        return;
//                    }
//                    if(is_w){
//                        is_w = false;
//                        drawChess(1,x,y);
//                    } else {
//                        is_w = true;
//                        drawChess(2,x,y);
//                    }
//                }
//            }
//        });


        var chessData;
        var canvas;
        var context;
        var is_w = true;
        var is_done = false;
        var img_w = new Image();
        img_w.src = "/image/img_w.png";
        var img_b = new Image();
        img_b.src = "/image/img_b.png";

//        function drawRect() {//页面加载完毕调用函数，初始化棋盘
//            chessData = new Array(15).fill(0).map(function (v,i,a) {
//                return new Array(15).fill(0);
//            });
//            canvas = document.getElementById("canvas");
//            context = canvas.getContext("2d");
//            for (var i = 0; i <= 640; i += 40) {//绘制棋盘的线
//                context.beginPath();
//                context.moveTo(0, i);
//                context.lineTo(640, i);
//                context.closePath();
//                context.stroke();
//                context.beginPath();
//                context.moveTo(i, 0);
//                context.lineTo(i, 640);
//                context.closePath();
//                context.stroke();
//            }
//        }

        function play(e) {
            var x = parseInt((e.clientX - 20)/40);
            var y = parseInt((e.clientY - 20)/40);
            var value = 1;
            if(x > 14 || y > 14 || chessData[x][y] != 0 || is_done){
                return;
            }
            if(is_w){
                is_w = false;
                drawChess(1,x,y);
            } else {
                is_w = true;
                value = 2;
                drawChess(2,x,y);
            }
            $.post("/web/judgment",{x:x,y:y,value:value},function(data){
                if(data == "win"){
                    is_done = true;
                    alert(data);
                }
            })
        }

        function drawChess(chess, x, y){
            if(chess == 1) {//w
                context.drawImage(img_w, x*40 + 20, y*40 +20);
                chessData[x][y] = 1;
            }else {
                context.drawImage(img_b, x*40 + 20, y*40 +20);
                chessData[x][y] = 2;
            }
        }
    </script>
    <title></title>
    </head>
    <body style="margin: 10px;">
        <div>
            <canvas width="640" id="canvas" onmousedown="play(event)"  height="640">
            </canvas>
        </div>
    </body>
</html>
